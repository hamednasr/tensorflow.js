<!DOCTYPE html>
<html>
  <head>
    <title>regression model in TensorFlow.js</title>
  </head>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
  <script lang="js">
    const csvUrl = 'https://gist.githubusercontent.com/netj/8836201/raw/6f9306ad21398ea43cba4f7d537619d0e07d5ae3/iris.csv'

    async function run(){
        const csvDataset = tf.data.csv(
            csvUrl, {
            columnConfigs: {
                variety: {
                isLabel: true
                }
            }
            });

        // Number of features is the number of column names minus one for the label column.
        const numOfFeatures = (await csvDataset.columnNames()).length - 1;

        // Prepare the Dataset for training.
        const flattenedDataset =
        csvDataset
        .map(({xs, ys}) =>
            {
            // Convert xs(features) and ys(labels) from object form (keyed by
            // column name) to array form.
            return {xs:Object.values(xs), ys:Object.values(ys)};
            })
        .batch(10);


        const history = await model.fit(xs, ys,{
        epochs:500,
        callbacks:{
          onEpochEnd: async(epoch, logs) => {
            console.log("Epoch: "+epoch+", Loss: "+logs.loss)
          }
        }
      });
    }
    const model = tf.sequential();
    model.add(tf.layers.dense({units:4, inputShape: [1]}));
    model.add(tf.layers.dense({units:1}));
    model.compile({loss:"meanSquaredError", optimizer:"adam"})
    model.summary();
    const xs = tf.tensor([1,2,3,4,5,6])
    const ys = xs.mul(2).add(3)


    doTraining(model).then(()=>{
      model.predict(tf.tensor([11])).print()
    });
  </script>
  <body></body>
</html>
